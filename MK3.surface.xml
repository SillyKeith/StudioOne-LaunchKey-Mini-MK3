<?xml version="1.0" encoding="utf-8"?>
<ControlSurface>
	<Controls>
		<Control name="pad[0]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#28" options="through" /> 
		</Control>
        <Control name="padLED[0]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#28" />
		</Control>
        <Control name="padChannel[0]" options="transmit fastupdate"> 
			<Handler class="ColorChannelHandler" channel="10"/> 
		</Control>
		<Control name="padEffect[0]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" /> 
		</Control>
        <Control name="padState[0]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" /> 
		</Control>

		<Control name="pad[1]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#29" options="through" />
		</Control>
        <Control name="padLED[1]" type="rgb" options="transmit fastupdate"> 
			<Handler class="PadColorLEDHandler" status="#9A" address="#29" />
		</Control>
        <Control name="padChannel[1]" options="transmit fastupdate"> 
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[1]" options="transmit fastupdate"> 
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[1]" options="transmit fastupdate"> 
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[2]" type="trigger" options="receive"> 
			<MidiMessage status="NoteTrigger" address="#2A" options="through" />
		</Control>
        <Control name="padLED[2]" type="rgb" options="transmit fastupdate"> 
			<Handler class="PadColorLEDHandler" status="#9A" address="#2A" />
		</Control>
        <Control name="padChannel[2]" options="transmit fastupdate"> 
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[2]" options="transmit fastupdate"> 
			<Handler class="ColorEffectHandler" />
		</Control>
		 <Control name="padState[2]" options="transmit fastupdate"> 
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[3]" type="trigger" options="receive"> 
			<MidiMessage status="NoteTrigger" address="#2B" options="through" />
		</Control>
        <Control name="padLED[3]" type="rgb" options="transmit fastupdate"> 
			<Handler class="PadColorLEDHandler" status="#9A" address="#2B" />
		</Control>
        <Control name="padChannel[3]" options="transmit fastupdate"> 
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[3]" options="transmit fastupdate"> 
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[3]" options="transmit fastupdate"> 
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[4]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#30" options="through" />
		</Control>
        <Control name="padLED[4]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#30" />
		</Control>
        <Control name="padChannel[4]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[4]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[4]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[5]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#31" options="through" />
		</Control>
        <Control name="padLED[5]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#31" />
		</Control>
        <Control name="padChannel[5]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[5]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[5]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[6]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#32" options="through" />
		</Control>
        <Control name="padLED[6]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#32" />
		</Control>
        <Control name="padChannel[6]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[6]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[6]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[7]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#33" options="through" />
		</Control>
        <Control name="padLED[7]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#33" />
		</Control>
        <Control name="padChannel[7]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[7]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[7]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <!-- Row 2 -->
        <Control name="pad[8]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#24" options="through"/>
		</Control>
        <Control name="padLED[8]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#24" />
		</Control>
        <Control name="padChannel[8]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[8]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[8]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[9]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#25" options="through"/>
		</Control>
        <Control name="padLED[9]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#25" />
		</Control>
        <Control name="padChannel[9]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[9]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[9]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[10]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#26" options="through"/>
		</Control>
        <Control name="padLED[10]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#26" />
		</Control>
        <Control name="padChannel[10]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[10]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[10]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[11]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#27" options="through"/>
		</Control>
        <Control name="padLED[11]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#27" />
		</Control>
        <Control name="padChannel[11]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[11]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[11]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[12]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2C" options="through"/>
		</Control>
        <Control name="padLED[12]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#2C" />
		</Control>
        <Control name="padChannel[12]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[12]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[12]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[13]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2D" options="through"/>
		</Control>
        <Control name="padLED[13]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#2D" />
		</Control>
        <Control name="padChannel[13]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[13]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[13]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[14]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2E" options="through"/>
		</Control>
        <Control name="padLED[14]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#2E" />
		</Control>
        <Control name="padChannel[14]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[14]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[14]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

        <Control name="pad[15]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2F" options="through"/>
		</Control>
        <Control name="padLED[15]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" status="#9A" address="#2F" />
		</Control>
        <Control name="padChannel[15]" options="transmit fastupdate">
			<Handler class="ColorChannelHandler" channel="10"/>
		</Control>
        <Control name="padEffect[15]" options="transmit fastupdate">
			<Handler class="ColorEffectHandler" />
		</Control>
		<Control name="padState[15]" options="transmit fastupdate">
			<Handler class="ColorStateHandler" />
		</Control>

	    <!-- This defines how we switch into various Pad modes -->
		<!-- Channel=15 is redunant with #BF -->
		<Control name="devicePadMode" title="Device Pad Mode" options="transmit receive">
            <MidiMessage status="#BF" address="#03" />  
        </Control>

        <Control name="devicePotMode" title="Device Pot Mode" options="transmit receive">
            <MidiMessage status="#B0" channel="15" address="9" />
        </Control>

        <Control name="shift" title="Shift" options="receive" type="button">
            <MidiMessage status="Controller" address="108" />
        </Control>

        <Control name="sceneHold" title="Scene" options="receive" type="button">
            <Handler class="ButtonHoldHandler" status="#B0" address="#68" />
        </Control>
        <Control name="scene" title="Scene" options="receive" type="trigger">
            <Handler class="ButtonHandler" bind="sceneHold" status="#B0" address="#68" />
        </Control>
        <Control name="sceneLED" options="transmit"> <Handler class="ColorLEDHandler" status="176" address="104" /> </Control>
        <Control name="sceneEffect" options="transmit fastupdate"> <Handler class="ColorEffectHandler" /> </Control>


        <Control name="ssm" title="Stop Solo Mute" options="receive" type="trigger">
            <MidiMessage status="Controller" address="105" />
        </Control>
        <Control name="ssmLED" options="transmit"> <Handler class="ColorLEDHandler" status="176" address="105" /> </Control>
        <Control name="ssmEffect" options="transmit fastupdate"> <Handler class="ColorEffectHandler" /> </Control>

        <Control name="arp" title="ARP" options="receive public" type="trigger">
            <MidiMessage status="Controller" address="103" />
        </Control>
        <Control name="arpLED" options="transmit">
            <Handler class="MonoLEDHandler" address="103" />
        </Control>

        <Control name="f_chord" title="Fixed Chord" options="receive public" type="trigger">
            <MidiMessage status="Controller" address="102" />
        </Control>
        <Control name="f_chordLED" options="transmit">
            <Handler class="MonoLEDHandler" address="102" />
        </Control>

        <Control name="play" options="receive" type="button">
            <MidiMessage status="Controller" address="115" />
        </Control>
        <Control name="playLED" options="transmit">
             <Handler class="MonoLEDHandler" address="115" />
        </Control>
        <Control name="record" options="receive" type="button">
            <MidiMessage status="Controller" address="117" />
        </Control>
        <Control name="recordLED" options="transmit">
            <Handler class="MonoLEDHandler" address="117" />
        </Control>

        <Control name="program" title="Program Up / Down" options="transmit receive">
            <MidiMessage status="#C0" options="" />
        </Control>

		<Control name="timeCode" options="transmit fastupdate" />
        <Control name="assignmentDisplay" options="transmit" />
    </Controls>

	<!-- ******************************************************************************************** -->
	<!-- SURFACE MAPPINGS -->
	<!-- ******************************************************************************************** -->

	<Mappings>
		<!-- The Pad modes are mapped to the following values and there will be an ENUM in the script: -->
		<!-- only the first 3 are used in the script, Custom_Mode 0 is really 5 -->
		<!--		• 00h (0): Custom Mode 0 -->
		<!--		• 01h (1): Drum layout -->
		<!--		• 02h (2): Session layout -->
		<!--		• 03h (3): Scale Chords -->
		<!--		• 04h (4): User Chords -->
		<!--		• 05h (5): Custom Mode 0 -->
		<!--		• 06h (6): Custom Mode 1 -->
		<!--		• 07h (7): Custom Mode 2 -->
		<!--		• 08h (8): Custom Mode 3 -->
		<!--		• 09h (9): Device Select -->
		<!--		• 0Ah (10): Navigation  -->
		
       	<!-- definitions to use symbolic names (must be kept in sync with script!) -->
		<!-- Device pad layouts -->
		<define name="$PLAY_MODE" value="0"/>
		<define name="$SETUP_MODE" value="1"/>
		<define name="$LOOP_EDIT_MODE" value="2"/>
		<define name="$EVENT_EDIT_MODE" value="3"/>
		<define name="$INSTRUMENT_EDIT_MODE" value="4"/>
		<define name="$BANK_MENU_MODE" value="5"/>
		<define name="$REPEAT_MENU_MODE" value="6"/>
		<define name="$PITCH_MENU_MODE" value="7"/>
		<define name="$RATE_TRIGGER_MODE" value="8"/>
		<define name="$STEP_EDIT_MODE" value="9"/>
		<define name="$RESTORE_PLAY_MODE" value="10"/>

        <define name="$DEVICE_PAD_CUSTOM" value="0"/>
		<define name="$DEVICE_PAD_DRUM_LAYOUT" value="1" />
		<define name="$DEVICE_PAD_SESSION_LAYOUT" value="2" />
	    <define name="$DEVICE_PAD_SCALE_CHORDS" value="3"/>
		<define name="$DEVICE_PAD_USER_CHORDS" value="4"/>
		<define name="$DEVICE_PAD_CUSTOM_MODE0" value="5" />
		 <!-- Extra to control a reset -->
		<!-- <define name="$SCALE_CHORDS" value="3"/> -->
		<!-- <define name="$USER_CHORDS" value="4"/> -->
		<!-- <define name="$CUSTOM_MODE_0" value="5"/> -->
		<!-- <define name="$CUSTOM_MODE_1" value="6"/> -->
		<!-- <define name="$CUSTOM_MODE_2" value="7"/> -->
		<!-- <define name="$CUSTOM_MODE_3" value="8"/> -->
		<!-- <define name="$DEVICE_SELECT" value="9"/> -->
		<!-- <define name="$NAVIGATION" value="10"/> -->
		<!-- <define name="$SESSION[STEP_EDIT_MODE]" value="0" /> -->
        <!-- <define name="$SESSION[EVENT_EDIT_MODE]" value="1" /> -->
        <!-- <define name="$SESSION[SETUP_MODE]" value="2" /> -->
        <!-- <define name="$SESSION[BANK_MENU_MODE]" value="3" /> -->
        <!-- <define name="$SESSION[HUI_MODE]" value="4" /> -->
        <!-- <define name="$SESSION[LOOP_EDIT_MODE]" value="5" /> -->
        <!-- <define name="$SESSION[INSTRUMENT_EDIT_MODE]" value="6" /> -->
		<!-- ******************************************************************************************** -->
		<!-- PAD SECTION -->
		<!-- ******************************************************************************************** -->
		<!-- There are two modes for the pads, Drum Layout and Session Layout -->
		<!-- On entering DAW mode we default to Session Layout so building these pads as default -->
		<!-- However, we quickly switch to Drum Layout at the script initialization -->
		<PadSection name="PadSessionSectionElement" rows="2" roles="musicinput stepedit">
			<foreach variable="$i" count="16">
				<Pad control="pad[$i]">
					<Value control="padLED[$i]" param="state"/>
					<PlainValue control="padLEDColor[$i]" param="color"/>
				</Pad>
			</foreach>
		</PadSection>
        
		<!-- ******************************************************************************************** -->
        <!-- NOTE WINDOW MANAGER -->
        <!-- ******************************************************************************************** -->
        <DeviceMapping device="WindowManager" name="WindowManagerElement">
            <Variant control="sceneHold">
            <!--    <Null /> -->
                <Invoke control="ssm" onReceive="onToggleWindow" />
            </Variant>
        </DeviceMapping>

        <GenericMapping>
            <PlainValue control="shift" param="shiftModifier" />
            <PlainValue control="ssm" param="sceneHold" />
        </GenericMapping>

		<!-- ******************************************************************************************** -->
		<!-- MIXER MAPPING -->
		<!-- ******************************************************************************************** -->

		<DeviceMapping device="MixerConsole" name="MixerMapping">
			<ScrollBank target="FollowBank" name="FocusBankElement">
				<Strip onConnect="onMixerConsoleFollowBankChanged"/>
			</ScrollBank>
		</DeviceMapping>

		<!-- ******************************************************************************************** -->
		<!-- INSTRUMENT TRACK MAPPINGS -->
		<!-- ******************************************************************************************** -->

		<DeviceMapping device="MusicTrackDevice" name="MusicTrackMapping">
			<Bank target="FocusChannel" name="FocusChannelMapping">
				<Strip onConnect="onMusicTrackFocusChannelChanged"/>
			</Bank>
			<Bank target="FocusInstrument" name="FocusInstrumentMapping">
				<!-- Detect sampler device for sampler controls. -->
				<Strip onConnect="onFocusInstrumentChanged"/>
			</Bank>
		</DeviceMapping>
        
        <!-- ******************************************************************************************** -->
        <!-- NOTE TRANSPORT PANEL -->
        <!-- ******************************************************************************************** -->
        <DeviceMapping device="TransportPanel" name="TransportPanelElement" onConnect="renderGlobals">

            <Segmented control="timeCode" param="primaryTime"/>

            <ParamInvoke param="start" onChanged="renderGlobals" />
            <ParamInvoke param="record" onChanged="renderGlobals" />
            <ParamInvoke param="loop" onChanged="renderGlobals" />

            <ParamVariant param="loop">
                <Command control="arp" command.category="Transport" command.name="Return to Zero" />
                <Command control="arp" command.category="Transport" command.name="Goto Loop Start" />
            </ParamVariant>

            <ParamVariant using="@global" param="shiftModifier">
                <Variant control="sceneHold">
                    <Group><!-- SCENE MODIFER OFF -->
                        <Command control="play" command.category="Transport" command.name="Toggle Start" />
                        <Command control="record" command.category="Transport" command.name="Record" />
                    </Group>
                    <Group><!-- SCENE MODIFER ON -->
                        <Invoke control="play" onReceive="onToggleLoopEditMode" />
                        <Command control="record" command.category="Edit" command.name="Undo" />
                    </Group>
                </Variant>
                <Group>
                    <Toggle control="play" param="loop" />
                    <Command control="record" command.category="Track" command.name="Arm" />
                </Group>
            </ParamVariant>
        </DeviceMapping>



		<!-- ******************************************************************************************** -->
		<!-- NOTE REPEAT MAPPING -->
		<!-- ******************************************************************************************** -->

		<DeviceMapping name="NoteRepeatElement" device="NoteRepeater" onConnect="onConnectNoteRepeat">
			<Invoke control="noterepeat" onReceive="onNoteRepeatButtonPressed"/>
			<Value control="noterepeatLED" param="active"/>
			<ParamInvoke param="active" onChanged="onActivateNoteRepeat"/>
			<ParamInvoke param="spread" onChanged="onSpreadModeChanged"/>
		</DeviceMapping>
		
		
		<!-- ******************************************************************************************** -->
        <!-- GLOBAL MAPPING -->
        <!-- ******************************************************************************************** -->
        <Global>
			<Toggle control="shift" param="shiftModifier" options="nonlatching"/>
            <Toggle control="sceneHold" param="sceneHold" options="nonlatching" />
			
			<PlainValue control="sceneLED" param="sceneColor" />
            <PlainValue control="sceneEffect" param="sceneEffect" />
            
            <Variant control="sceneHold">
            <!--    <Null /> -->
                <Group>
                    <PlainValue control="sceneLED" param="GREEN" />
                    <PlainValue control="sceneEffect" param="EFFECT_PULSE" />
                </Group>
            </Variant>
               
                
            <!-- ******************************************************************************************** -->
            <!-- Default controls for any pad mode.  -->
            <!-- ******************************************************************************************** -->
             			<!-- Indicate pad focus on, off. -->
			<ParamVariant param="padFocusMode">
				<PlainValue control="presetLEDColor" param="padFocusOffColor"/>
				<PlainValue control="presetLEDColor" param="padFocusOnColor"/>
			</ParamVariant>

        </Global>

        <!-- ******************************************************************************************** -->
		<!-- METRONOME MAPPING -->
		<!-- ******************************************************************************************** -->

		<DeviceMapping device="Metronome">
			<ParamVariant using="@global" param="shiftModifier">
				<!-- Shift off-->
				<Group>
					<Toggle control="click" param="clickOn"/>
					<Value control="clickLED" param="clickOn"/>
				</Group>
				<!-- Shift on -->
				<Group>
					<Toggle control="click" param="precount"/>
					<Value control="clickLED" param="precount"/>
				</Group>
			</ParamVariant>
		</DeviceMapping>

	</Mappings>
</ControlSurface>
